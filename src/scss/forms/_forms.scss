label {
  color: $input-label-color;
}
fieldset {
  legend {
    z-index: 1;
    display: block;
    width: auto;
    max-width: 100%;
    margin-bottom: 0;
    padding: 0 $input-spacing-x;
    float: none;
    background-color: transparent;
    color: $input-label-color;
    font-size: $small-font-size;
    font-weight: 700;
    line-height: calc(#{$input-height} - 1px);
    transition: 0.2s ease-out;
    cursor: text;
  }
}
.form-text {
  color: $color-text-secondary;
}
.form-group {
  position: relative;
  margin-top: $form-group-margin-top;
  margin-bottom: $form-group-margin-bottom;

  input,
  optgroup,
  textarea {
    color: $color-text-muted;
  }

  label {
    position: absolute;
    top: 0;
    z-index: 5;
    display: block;
    width: auto;
    max-width: 100%;
    padding: 0 $input-spacing-x;
    background-color: transparent;
    color: $input-color-placeholder;
    font-size: 1rem;
    line-height: calc(#{$input-height} - 1px);
    transition: 0.2s ease-out;
    cursor: text;
    &.active {
      color: $input-label-color;
      font-size: $small-font-size;
      font-weight: 600;
      transform: translateY(-85%);
    }
    &.input-symbol-label {
      &:not(.active) {
        left: 2.25rem;
      }
    }
  }

  input:is([type='radio']),
  input:is([type='checkbox']) {
    & + label.active {
      transform: translateY(0%);
    }
  }

  small.form-text {
    margin: 0;
    padding: $input-spacing-x * 0.5 $input-spacing-x;
    font-size: $small-font-size;
  }

  input[type='time'] ~ label {
    font-size: $small-font-size;
    transform: translateY(-75%);
  }
}

::placeholder {
  color: $input-color-placeholder;
}

input[type='date'],
input[type='datetime-local'],
input[type='email'],
input[type='number'],
input[type='password'],
input[type='search'],
input[type='tel'],
input[type='text'],
input[type='time'],
input[type='url'],
textarea {
  padding: $input-spacing-y $input-spacing-x;
  border: none;
  border-bottom: 1px solid $input-border;
  outline: 0;
  box-shadow: none;
  transition: none;
  -webkit-appearance: none;
  &::placeholder {
    color: $input-color-placeholder;
  }
}

input[type='date'],
input[type='datetime-local'],
input[type='time'] {
  display: flex;
}

textarea {
  height: auto;
  border: 1px solid $input-border;
  font-size: 1rem;
}

.form-control {
  min-height: 2.5rem;
  border-radius: 0 !important;
  background-repeat: no-repeat !important;
  background-position: center right !important;
  background-size: 45px 45% !important;
  &.form-control-lg {
    border-radius: 0;
  }
  &:disabled,
  &[readonly] {
    cursor: not-allowed;

    & + label {
      background-color: transparent;
      cursor: not-allowed;
    }
  }
  &:active {
    box-shadow: none !important;
  }
  .was-validated &:valid,
  &.is-valid {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2300cc85' viewBox='0 0 192 512'%3E%3Cpath d='M435.848 83.466L172.804 346.51l-96.652-96.652c-4.686-4.686-12.284-4.686-16.971 0l-28.284 28.284c-4.686 4.686-4.686 12.284 0 16.971l133.421 133.421c4.686 4.686 12.284 4.686 16.971 0l299.813-299.813c4.686-4.686 4.686-12.284 0-16.971l-28.284-28.284c-4.686-4.686-12.284-4.686-16.97 0z'/%3E%3C/svg%3E");
  }

  .was-validated &:invalid,
  &.is-invalid {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23f73e5a' viewBox='0 0 384 512'%3E%3Cpath d='M231.6 256l130.1-130.1c4.7-4.7 4.7-12.3 0-17l-22.6-22.6c-4.7-4.7-12.3-4.7-17 0L192 216.4 61.9 86.3c-4.7-4.7-12.3-4.7-17 0l-22.6 22.6c-4.7 4.7-4.7 12.3 0 17L152.4 256 22.3 386.1c-4.7 4.7-4.7 12.3 0 17l22.6 22.6c4.7 4.7 12.3 4.7 17 0L192 295.6l130.1 130.1c4.7 4.7 12.3 4.7 17 0l22.6-22.6c4.7-4.7 4.7-12.3 0-17L231.6 256z'/%3E%3C/svg%3E");
  }

  &.warning {
    border-color: $warning;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23ff9900' viewBox='0 0 192 512'%3E%3Cpath d='M176 432c0 44.112-35.888 80-80 80s-80-35.888-80-80 35.888-80 80-80 80 35.888 80 80zM25.26 25.199l13.6 272C39.499 309.972 50.041 320 62.83 320h66.34c12.789 0 23.331-10.028 23.97-22.801l13.6-272C167.425 11.49 156.496 0 142.77 0H49.23C35.504 0 24.575 11.49 25.26 25.199z'/%3E%3C/svg%3E");
    background-size: 25px 45% !important;
  }

  &.is-valid ~ .warning-feedback {
    display: block;
  }
}

.form-group.active .form-file-name {
  padding-bottom: 1.95rem;
}

.form-control-plaintext {
  padding: $input-spacing-y $input-spacing-x;
  background-color: $white !important;
  cursor: not-allowed;

  & + label {
    cursor: not-allowed;
  }
}

.warning-feedback {
  display: none;
  width: 100%;
  margin-top: 0.25rem;
  color: $warning;
  font-size: 0.75rem;
}

.valid-feedback,
.invalid-feedback,
.warning-feedback {
  margin-left: 0.5rem;
}

// Input group
.input-group {
  .input-group-text {
    min-width: 40px;
    min-height: 2.5rem;
    margin-right: 0;
    padding: $input-spacing-y $input-spacing-x;
    border-bottom: 1px solid $input-border;
    border-radius: 0;

    .icon {
      fill: $icon-secondary;
    }

    & ~ label {
      max-width: calc(100% - 2.25rem);
      &:not(.active) {
        left: 2.25rem;
      }
    }

    .btn {
      border-radius: 4px 0 0 4px;
    }
  }

  .input-group-append {
    margin-left: 0;
    .btn {
      height: 100%;
      padding-top: 0;
      padding-bottom: 0;
      border-bottom: 1px solid $input-border;
      border-radius: 0 4px 4px 0;
    }
  }
}

.input-group-lg {
  & > .form-control,
  & > .input-group-append > .input-group-text,
  & > .input-group-append > .btn {
    padding: 0 1rem;
    border-radius: 0;
  }
}

.form-check {
  position: relative;
  margin-bottom: 0.5rem;
  padding-left: 0;

  // add vertical spacing for consequential elements
  & + & {
    margin-top: 0.5rem;
  }

  [type='checkbox'],
  [type='radio'] {
    position: absolute;
    top: 9px;
    left: 9px;
    margin-top: 0;
    margin-left: 0;
    opacity: 0;

    + label {
      position: relative;
      display: inline-block;
      padding-left: 2rem;
      font-size: 1rem;
      font-weight: $font-weight-semibold;
      cursor: pointer;
      user-select: none;
      @include media-breakpoint-up(sm) {
        font-size: 1.125rem;
      }
    }

    //focus
    &:focus + label {
      @extend %focus;
    }

    &:focus.focus--mouse + label {
      @extend %focusmouse;
    }
  }

  [type='checkbox'] {
    + label::after,
    + label::before {
      position: absolute;
      left: 0;
      z-index: 1;
      content: '';
      border-width: 2px;
      border-style: solid;
      transition: 0.2s ease-out;
    }

    + label::before {
      top: 0;
      width: 17px;
      height: 17px;
      margin: 2px 4px;
      border: 1px solid #e6e9f2;
      border-radius: 1px;
      transform: rotateZ(37deg);
      transform-origin: 100% 100%;
    }

    + label::after {
      top: 0;
      width: 20px;
      height: 20px;
      margin: 4px;
      border-radius: 4px;
    }

    &:checked + label::before {
      top: 4px;
      left: 1px;
      width: 8px;
      height: 13px;
      border-width: 2px;
      border-style: solid;
      border-color: transparent #fff #fff transparent;
      opacity: 0.8;
      transform: rotate(40deg);
      transform-origin: 100% 100%;
      backface-visibility: hidden;
    }

    &:checked + label::after {
      z-index: 0;
      border-color: $primary;
      background-color: $primary;
    }

    &:not(:checked) + label::after {
      z-index: 0;
      border-color: $neutral-1-a7;
      background-color: transparent;
    }

    &:not(:checked) + label::before {
      top: 10px;
      left: 6px;
      width: 0;
      height: 0;
      border-color: transparent;
    }

    &:disabled + label {
      opacity: 1;
      cursor: not-allowed;
    }

    &:disabled:not(:checked) + label::after {
      border-color: #e6e9f2;
      background-color: #fff;
    }

    &:disabled:checked + label::after {
      border-color: #e6e9f2;
      background-color: #e6e9f2;
    }
  }

  [type='radio'] {
    + label {
      transition: 0.2s ease-out;

      &::after,
      &::before {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 0;
        content: '';
        width: 20px;
        height: 20px;
        margin: 5px;
        border-width: 2px;
        border-style: solid;
        border-radius: 50%;
        transition: 0.2s ease-out;
      }
    }

    &:not(:checked) + label {
      &::after,
      &::before {
        border-color: $input-border;
      }

      &:after {
        z-index: -1;
        transform: scale(0);
      }
    }

    &:checked + label {
      &::after {
        z-index: 0;
        border-color: $primary;
        background-color: $primary;
        transform: scale(0.64);
      }

      &::before {
        border-color: $primary;
      }
    }

    &:disabled {
      & + label {
        cursor: not-allowed;
      }

      &:not(:checked) + label {
        &::after,
        &::before {
          border-color: $gray-border-disabled;
        }
      }

      &:checked + label {
        &::after {
          border-color: $gray-border-disabled;
          background-color: $gray-disabled;
        }

        &::before {
          border-color: $gray-border-disabled;
        }
      }
    }
  }

  // gruppi
  &.form-check-group {
    margin-bottom: 1rem;
    padding: 0 0 1rem 0;
    box-shadow: inset 0 -1px 0 0 rgba(1, 1, 1, 0.1);

    [type='checkbox'] + label,
    [type='radio'] + label {
      position: static;
      padding-right: 3.25rem;
      padding-left: 0;

      &::after,
      &::before {
        right: 0px;
        left: auto;
      }
    }

    [type='checkbox']:checked + label::before {
      right: 11px;
    }

    [type='radio']:checked + label::before {
      right: 0px;
    }

    .form-text {
      display: block;
      margin-bottom: 0.5rem;
      padding-right: 3.25rem;
    }

    input.semi-checked:not(:checked) + label::before {
      right: 4px;
      left: auto;
    }
  }
  input.semi-checked:not(:checked) + label::before {
    top: 11px;
    left: 4px;
    width: 12px;
    height: 2px;
    border-width: 0;
    border-style: none;
    border-color: transparent;
    opacity: 1;
    background: $white;
    transform: none;
    backface-visibility: hidden;
  }

  input.semi-checked:not(:checked) + label::after {
    z-index: 0;
    border-color: $primary-a5; // TODO: Not found
    background-color: $primary-a5; // TODO: Not found
  }
}

@media (prefers-reduced-motion: reduce) {
  fieldset legend,
  .form-group label,
  textarea,
  .form-check [type='checkbox'],
  .form-check [type='radio'],
  .form-check [type='checkbox'] + label::after,
  .form-check [type='checkbox'] + label::before,
  .form-check [type='radio'] + label::after,
  .form-check [type='radio'] + label::before,
  .toggles label input[type='checkbox'] + .lever::before,
  .toggles label input[type='checkbox'] + .lever::after {
    transition: none !important;
  }
}

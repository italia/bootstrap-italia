.navbar {
  --#{$prefix}navbar-spacing-inset: var(--#{$prefix}spacing-inset-m);
  --#{$prefix}navbar-spacing-stack: var(--#{$prefix}spacing-stack-s);
  --#{$prefix}navbar-sidebar-bg-color-mobile: rgba(0, 0, 0, 0.6);
  --#{$prefix}navbar-close-button-size: 44px;
  --#{$prefix}navbar-close-button-text-color: var(--#{$prefix}color-text-secondary);
  --#{$prefix}navbar-close-button-text-size: 0.75rem;
  --#{$prefix}navbar-close-button-icon-size: 2rem;
  --#{$prefix}navbar-links-margin-top: 102px;
  --#{$prefix}navbar-link-color: var(--#{$prefix}color-text-primary);
  --#{$prefix}navbar-link-color-desk: var(--#{$prefix}color-text-inverse);
  --#{$prefix}navbar-link-active-bar-size: var(--#{$prefix}border-thick);
  --#{$prefix}navbar-link-active-bar-color: var(--#{$prefix}color-text-primary);
  --#{$prefix}navbar-link-active-bar-color-desk: var(--#{$prefix}color-text-inverse);
  --#{$prefix}navbar-toggle-button-icon-color: var(--#{$prefix}icon-inverse);
  --#{$prefix}navbar-toggle-button-icon-size: 1.5rem;
  --#{$prefix}navbar-dropdown-icon-size: 0.75rem;
  --#{$prefix}navbar-dropdown-icon-line-height: 1rem;
  --#{$prefix}navbar-dropdown-icon-width: 1rem;
  --#{$prefix}navbar-disabled-item-opacity: 0.6;
  --#{$prefix}navbar-disabled-item-mobile-opacity: 0.6;
  --#{$prefix}navbar-hamburger-size: 1.5rem;
  --#{$prefix}navbar-background: var(--#{$prefix}color-background-primary);
}

//mobile
//menu on bottom animation
@keyframes megamenuFadeIn {
  0% {
    opacity: 0;
    margin-top: 1rem;
  }

  100% {
    opacity: 1;
    margin-top: 1rem;
  }
}

.row.row-column-border > [class^='col-'] .navbar {
  padding: 8px 0;
}

.navbar {
  background: var(--#{$prefix}navbar-background);

  // overlay div
  .overlay {
    position: fixed;
    top: 0;
    right: 0;
    left: 0;
    bottom: 0;
    background: var(--#{$prefix}navbar-sidebar-bg-color-mobile);
    display: none;
  }

  // navbar mobile
  .navbar-collapsable {
    position: fixed;
    top: 0;
    right: 0;
    left: 0;
    bottom: 0;
    z-index: 100;
    display: none;
    width: 100%; //-occupa sempre tutta lo spazio orizzontale disponibile

    .menu-wrapper {
      background: var(--#{$prefix}color-background-inverse);
      position: absolute;
      top: 0;
      bottom: 0;
      right: calc(var(--#{$prefix}navbar-spacing-inset) * 2);
      left: 0;
      pointer-events: all;
      overflow-y: auto;
      transform: translateX(-100%);
      transition: all 0.2s cubic-bezier(0.29, 0.85, 0.5, 0.99);
      z-index: 5;

      .navbar-nav {
        padding: var(--#{$prefix}navbar-spacing-inset) 0 0;
        overflow: hidden;

        .dropdown-menu {
          padding-bottom: 0;
        }
      }
    }

    /*lista menu*/
    .navbar-nav {
      padding: var(--#{$prefix}navbar-spacing-inset) 0;

      li {
        > button.nav-link {
          border: none;
          display: block;
          background: transparent;
          color: var(--#{$prefix}color-text-primary);
          font-weight: 600;
          padding: var(--#{$prefix}navbar-spacing-stack) var(--#{$prefix}navbar-spacing-inset);
          position: relative;

          &.dropdown-toggle {
            svg {
              fill: var(--#{$prefix}icon-primary);
              transition: all 0.3s;
            }

            &[aria-expanded='true'] {
              .icon {
                transform: scaleY(-1);
              }
            }
          }

          &.active {
            border-left: var(--#{$prefix}navbar-link-active-bar-size) solid var(--#{$prefix}navbar-link-active-bar-color);
          }

          &.disabled {
            span,
            .icon {
              opacity: var(--#{$prefix}navbar-disabled-item-mobile-opacity);
            }
          }

          &:hover:not(.active) {
            text-decoration: underline;
          }
        }

        a.nav-link {
          color: var(--#{$prefix}color-text-primary);
          font-weight: 600;
          padding: var(--#{$prefix}navbar-spacing-stack) var(--#{$prefix}navbar-spacing-inset);
          position: relative;

          &.dropdown-toggle {
            svg {
              fill: var(--#{$prefix}icon-inverse);
              transition: all 0.3s;
            }

            &[aria-expanded='true'] {
              .icon {
                transform: scaleY(-1);
              }
            }
          }

          &.active {
            border-left: var(--#{$prefix}navbar-link-active-bar-size) solid var(--#{$prefix}navbar-link-active-bar-color);
          }

          &.disabled {
            span,
            .icon {
              opacity: var(--#{$prefix}navbar-disabled-item-mobile-opacity);
            }
          }

          &:hover:not(.active) {
            text-decoration: underline;
          }
        }
      }
    }

    &.expanded {
      .menu-wrapper {
        transform: translateX(0);
        transition: all 0.3s cubic-bezier(0.29, 0.85, 0.5, 0.99);
      }

      .close-div {
        //transform: translateX(0);
        opacity: 1;
      }
    }
  }

  //wrapper pulsante di chiusura menu
  .close-div {
    opacity: 0;
    position: fixed;
    left: auto;
    right: 2px;
    top: var(--#{$prefix}navbar-spacing-inset);
    background: transparent;
    z-index: 10;
    pointer-events: none;
    transition: all 0.3s cubic-bezier(0.1, 0.57, 0.4, 0.97);

    // pulsante di chiusura menu
    .close-menu {
      background: transparent;
      pointer-events: all;
      color: var(--#{$prefix}navbar-close-button-text-color);
      font-size: var(--#{$prefix}navbar-close-button-text-size);
      padding: 0;
      width: var(--#{$prefix}navbar-close-button-size);
      height: var(--#{$prefix}navbar-close-button-size);
      display: flex;
      align-items: center;
      justify-content: center;

      .icon {
        fill: var(--#{$prefix}icon-inverse);
      }
    }
  }

  // Dropdown style tipo collapse
  .dropdown-menu {
    background: transparent;
    box-shadow: none;
    padding-top: 0;

    &:before {
      display: none;
    }

    a.it-heading-link,
    a.it-footer-link {
      color: var(--#{$prefix}navbar-link-color);

      svg {
        fill: var(--#{$prefix}navbar-link-color);
      }

      &.active {
        span {
          text-decoration: underline;
          color: var(--#{$prefix}navbar-link-color);
        }
      }
    }

    .link-list-wrapper {
      padding-left: var(--#{$prefix}navbar-spacing-inset);
      padding-right: var(--#{$prefix}navbar-spacing-inset);
      margin-bottom: var(--#{$prefix}navbar-spacing-inset);

      ul li {
        a {
          &.list-item.active {
            color: var(--#{$prefix}color-text-primary);
            text-decoration: underline;

            span {
              color: var(--#{$prefix}color-text-primary);
            }
          }

          svg {
            fill: var(--#{$prefix}navbar-link-color);
          }

          span {
            color: var(--#{$prefix}navbar-link-color);
          }

          i {
            color: var(--#{$prefix}navbar-link-color);
          }
        }
      }
    }
  }
}

.custom-navbar-toggler {
  background: none;
  border: none;
  cursor: pointer;

  span {
    color: var(--#{$prefix}navbar-toggle-button-icon-color);
    font-size: var(--#{$prefix}navbar-toggle-button-icon-size);
  }

  svg {
    fill: var(--#{$prefix}navbar-toggle-button-icon-color);
    width: var(--#{$prefix}navbar-hamburger-size);
    height: var(--#{$prefix}navbar-hamburger-size);
    display: block;
  }
}

//reset icon on megamenu
.nav-item.megamenu > a:before,
.nav-item.megamenu > button:before {
  display: none;
}

//-------------------INLINE MENU---------------------
.inline-menu {
  .link-list-wrapper {
    .link-list {
      position: relative;

      li {
        a {
          position: relative;

          &.large {
            padding-top: var(--inline-menu-linklist-v-padding);
            padding-bottom: var(--inline-menu-linklist-v-padding);
          }

          i {
            color: var(--#{$prefix}color-text-primary-a3);
          }

          &:after {
            content: '';
            display: block;
            width: var(--inline-menu-line-width);
            background: var(--#{$prefix}color-text-primary);
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            transform-origin: center;
            transform: scaleY(0);
            transition: all 0.3s;
            z-index: 1;
          }

          &.active {
            span {
              color: var(--#{$prefix}color-text-primary);
              text-decoration: none;
            }
          }

          &[aria-expanded='true'] {
            &:after {
              transform: scaleY(1);
            }
          }
        }
      }

      &:after {
        content: '';
        display: block;
        width: var(--inline-menu-line-width);
        background: linear-gradient(to bottom, rgba(var(--#{$prefix}-neutral-2-a1), 1) 0%, rgba(var(--#{$prefix}-neutral-2-a1), 0.3) 100%);
        position: absolute;
        right: 0;
        top: 0;
        height: 100%;
      }
    }
  }
}

//Tablet horizontal / small desktop
@media (min-width: #{map-get($grid-breakpoints, lg)}) {
  .row.row-column-border > [class^='col-'] .navbar {
    padding: 0;
  }

  .navbar {
    background: var(--#{$prefix}navbar-background);
    padding: 0;

    // navbar mobile
    .navbar-collapsable {
      position: relative;
      top: auto;
      right: auto;
      left: auto;
      bottom: auto;
      z-index: auto;
      background: none;
      display: block !important; //-sovrascrive l'inline style di jquery
      transition: none;

      .overlay {
        display: none !important;
      }

      // menu wrapper
      .menu-wrapper {
        position: inherit;
        top: auto;
        bottom: auto;
        right: auto;
        left: auto;
        overflow-y: visible;
        transform: none;
        transition: none;
        background: var(--#{$prefix}navbar-bg-color-desktop);

        .navbar-nav {
          margin-top: 0;
          padding: 0 var(--#{$prefix}navbar-spacing-inset);
          overflow: inherit;

          .dropdown-menu {
            padding-bottom: var(--link-list-footer-distance-bottom);
          }
        }
      }

      /*lista menu*/
      .navbar-nav {
        margin-top: 0;
        padding: 0 var(--#{$prefix}navbar-spacing-inset);

        li.nav-item {
          display: flex;

          a.nav-link,
          button.nav-link {
            display: flex;
            align-self: flex-end;
            align-items: center;
            font-weight: var(--#{$prefix}nav-link-font-weight);
            padding: var(--#{$prefix}navbar-spacing-stack) var(--#{$prefix}navbar-spacing-inset);
            color: var(--#{$prefix}navbar-link-color-desk);
            border-bottom: var(--#{$prefix}navbar-link-active-bar-size) solid transparent;

            &.dropdown-toggle {
              svg {
                fill: var(--#{$prefix}icon-primary);
                margin-top: 3px;
              }
            }

            &.focus--mouse {
              border-color: transparent !important;
            }

            &.active {
              border-left: 0;
              border-color: var(--#{$prefix}navbar-link-active-bar-color-desk);
              background: transparent;
            }

            &.disabled {
              span,
              .icon {
                opacity: var(--#{$prefix}navbar-disabled-item-opacity);
              }
            }
          }
        }
      }
    }

    //wrapper pulsante di chiusura menu
    .close-div {
      display: none;
    }

    // Dropdown style tipo collapse
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: var(--zindex-dropdown);
      //display: none; // none by default, but block on "open" of the menu
      float: left;
      min-width: var(--dropdown-min-width);
      padding: var(--dropdown-padding-y) 0 0;
      margin: var(--dropdown-spacer) 0 0; // override default ul
      font-size: var(--font-size-base); // Redeclare because nesting can cause inheritance issues
      color: var(--body-color);
      text-align: left; // Ensures proper alignment if parent has it changed (e.g., modal footer)
      list-style: none;
      background-color: var(--dropdown-bg);
      background-clip: padding-box;
      border: var(--dropdown-border-width) solid var(--dropdown-border-color);
      @include border-radius(var(--dropdown-border-radius));
      @include box-shadow(var(--dropdown-box-shadow));
      border-top-left-radius: 0;
      border-top-right-radius: 0;

      &.show {
        animation: dropdownFadeIn forwards var(--dropdown-menu-animation-speed);
        top: calc(100% - var(--dropdown-menu-vertical-shift));
      }

      &:before {
        display: block;
      }

      .link-list-wrapper {
        padding-left: 0;
        padding-right: 0;
        margin-bottom: 0;

        ul li {
          a {
            color: var(--#{$prefix}color-text-primary);

            span,
            i {
              color: var(--#{$prefix}color-text-primary);
            }
          }
        }
      }
    }

    .dropdown-toggle {
      display: block;
      justify-content: inherit;
    }
  }

  .custom-navbar-toggler {
    display: none;
  }

  .has-megamenu {
    .navbar-collapsable {
      width: 100%;
    }
  }

  .nav-item.megamenu {
    position: static;

    > a.dropdown-toggle,
    > button.dropdown-toggle {
      position: relative;

      &:before {
        content: '';
        position: absolute;
        top: auto;
        bottom: calc(var(--dropdown-menu-notch-base-size) * -1 - 6);
        left: var(--dropdown-menu-notch-position-x);
        width: calc(var(--dropdown-menu-notch-base-size) * 3);
        height: calc(var(--dropdown-menu-notch-base-size) * 3);
        border-radius: var(--dropdown-menu-radius);
        background-color: var(--dropdown-bg);
        transform: rotate(45deg);
        opacity: 0;
        display: block;
        transition: opacity calc(var(--dropdown-menu-animation-speed) * 0.5) cubic-bezier(0.1, 0.57, 0.36, 0.99);
      }
    }

    > button.dropdown-toggle:before {
      bottom: calc(var(--dropdown-menu-notch-base-size) * -1 - 8);
    }

    a.dropdown-toggle,
    button.dropdown-toggle {
      &.show {
        &:before {
          opacity: 1;
        }
      }
    }
  }

  .megamenu {
    .dropdown-menu {
      min-width: auto;
      left: var(--#{$prefix}navbar-spacing-inset);
      right: var(--#{$prefix}navbar-spacing-inset);
      animation-timing-function: cubic-bezier(0.1, 0.57, 0.36, 0.99);

      //hide arrow
      &:before {
        display: none;
      }

      &.show {
        animation: megamenuFadeIn forwards calc(var(--dropdown-menu-animation-speed) * 0.5);
      }
    }
  }
}

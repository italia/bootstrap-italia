{"version":3,"file":"accept-overlay.js","sources":["../../src/js/plugins/accept-overlay.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap Italia (https://italia.github.io/bootstrap-italia/)\n * Authors: https://github.com/italia/bootstrap-italia/blob/main/AUTHORS\n * Licensed under BSD-3-Clause license (https://github.com/italia/bootstrap-italia/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\n\nimport { reflow } from './util/index'\nimport { cookies } from './util/cookies'\nimport SelectorEngine from './dom/selector-engine'\n\nconst NAME = 'acceptoverlay'\n\nconst CLASS_NAME_FADE = 'fade'\nconst CLASS_NAME_SHOW = 'show'\n\nconst SELECTOR_DATA_TOGGLE = '[data-bs-accept-from]'\nconst SELECTOR_DATA_REMEMBER = '[data-bs-accept-remember]'\n\nclass AcceptOverlay extends BaseComponent {\n  constructor(element, config) {\n    const parentElement = element.closest('.acceptoverlay')\n    super(parentElement)\n    this._overlayable = element.closest('.acceptoverlayable')\n    const remember = cookies.isChoiceRemembered(config.service)\n    this._isShown = true\n    this._toggleElement = element\n    if (this._element.classList.contains(CLASS_NAME_SHOW)) {\n      this._overlayable.classList.add(CLASS_NAME_SHOW)\n    }\n    if (remember) {\n      this.hide()\n      setTimeout(() => {\n        this._toggleElement.dispatchEvent(new Event('click'))\n      }, 100)\n      return\n    }\n    this._toggleElement.addEventListener('click', () => {\n      this.hide()\n      this._remember = this._toggleElement.parentElement.querySelector(SELECTOR_DATA_REMEMBER).checked\n      cookies.rememberChoice(config.service, this._remember)\n    })\n  }\n\n  // Getters\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n\n  show() {\n    if (this._isShown || this._isTransitioning) {\n      return\n    }\n\n    this._isShown = true\n\n    if (this._isAnimated()) {\n      this._isTransitioning = true\n    }\n\n    this._showElement()\n  }\n\n  hide() {\n    if (!this._isShown || this._isTransitioning) {\n      return\n    }\n\n    this._isShown = false\n    const isAnimated = this._isAnimated()\n\n    if (isAnimated) {\n      this._isTransitioning = true\n    }\n\n    this._element.classList.remove(CLASS_NAME_SHOW)\n    this._overlayable.classList.remove(CLASS_NAME_SHOW)\n\n    this._queueCallback(() => this._hideElement(), this._element, isAnimated)\n  }\n\n  //Private\n\n  _isAnimated() {\n    return this._element.classList.contains(CLASS_NAME_FADE)\n  }\n\n  _showElement() {\n    const isAnimated = this._isAnimated()\n\n    this._element.removeAttribute('aria-hidden')\n\n    if (isAnimated) {\n      reflow(this._element)\n    }\n\n    this._element.classList.add(CLASS_NAME_SHOW)\n    this._overlayable.add(CLASS_NAME_SHOW)\n\n    const transitionComplete = () => {\n      this._isTransitioning = false\n    }\n\n    this._queueCallback(transitionComplete, this._element, isAnimated)\n  }\n\n  _hideElement() {\n    this._element.setAttribute('aria-hidden', true)\n    this._isTransitioning = false\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Api implementation\n * ------------------------------------------------------------------------\n */\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n  const acceptOverlays = SelectorEngine.find(SELECTOR_DATA_TOGGLE)\n  if (acceptOverlays.length > 0) {\n    acceptOverlays.forEach((element) => {\n      AcceptOverlay.getOrCreateInstance(element, { service: element.dataset.bsAcceptFrom })\n    })\n  }\n}\nexport default AcceptOverlay\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAQA,MAAM,IAAI,GAAG;;AAEb,MAAM,eAAe,GAAG;AACxB,MAAM,eAAe,GAAG;;AAExB,MAAM,oBAAoB,GAAG;AAC7B,MAAM,sBAAsB,GAAG;;AAE/B,MAAM,aAAa,SAAS,aAAa,CAAC;AAC1C,EAAE,WAAW,CAAC,OAAO,EAAE,MAAM,EAAE;AAC/B,IAAI,MAAM,aAAa,GAAG,OAAO,CAAC,OAAO,CAAC,gBAAgB;AAC1D,IAAI,KAAK,CAAC,aAAa;AACvB,IAAI,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC,OAAO,CAAC,oBAAoB;AAC5D,IAAI,MAAM,QAAQ,GAAG,OAAO,CAAC,kBAAkB,CAAC,MAAM,CAAC,OAAO;AAC9D,IAAI,IAAI,CAAC,QAAQ,GAAG;AACpB,IAAI,IAAI,CAAC,cAAc,GAAG;AAC1B,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE;AAC3D,MAAM,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,GAAG,CAAC,eAAe;AACrD;AACA,IAAI,IAAI,QAAQ,EAAE;AAClB,MAAM,IAAI,CAAC,IAAI;AACf,MAAM,UAAU,CAAC,MAAM;AACvB,QAAQ,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC;AAC5D,OAAO,EAAE,GAAG;AACZ,MAAM;AACN;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAM;AACxD,MAAM,IAAI,CAAC,IAAI;AACf,MAAM,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,aAAa,CAAC,sBAAsB,CAAC,CAAC;AAC/F,MAAM,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS;AAC3D,KAAK;AACL;;AAEA;;AAEA,EAAE,WAAW,IAAI,GAAG;AACpB,IAAI,OAAO;AACX;;AAEA;;AAEA,EAAE,IAAI,GAAG;AACT,IAAI,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,gBAAgB,EAAE;AAChD,MAAM;AACN;;AAEA,IAAI,IAAI,CAAC,QAAQ,GAAG;;AAEpB,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE,EAAE;AAC5B,MAAM,IAAI,CAAC,gBAAgB,GAAG;AAC9B;;AAEA,IAAI,IAAI,CAAC,YAAY;AACrB;;AAEA,EAAE,IAAI,GAAG;AACT,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,gBAAgB,EAAE;AACjD,MAAM;AACN;;AAEA,IAAI,IAAI,CAAC,QAAQ,GAAG;AACpB,IAAI,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW;;AAEvC,IAAI,IAAI,UAAU,EAAE;AACpB,MAAM,IAAI,CAAC,gBAAgB,GAAG;AAC9B;;AAEA,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,eAAe;AAClD,IAAI,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,eAAe;;AAEtD,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,IAAI,CAAC,YAAY,EAAE,EAAE,IAAI,CAAC,QAAQ,EAAE,UAAU;AAC5E;;AAEA;;AAEA,EAAE,WAAW,GAAG;AAChB,IAAI,OAAO,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,eAAe;AAC3D;;AAEA,EAAE,YAAY,GAAG;AACjB,IAAI,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW;;AAEvC,IAAI,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,aAAa;;AAE/C,IAAI,IAAI,UAAU,EAAE;AACpB,MAAM,MAAM,CAAC,IAAI,CAAC,QAAQ;AAC1B;;AAEA,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,eAAe;AAC/C,IAAI,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,eAAe;;AAEzC,IAAI,MAAM,kBAAkB,GAAG,MAAM;AACrC,MAAM,IAAI,CAAC,gBAAgB,GAAG;AAC9B;;AAEA,IAAI,IAAI,CAAC,cAAc,CAAC,kBAAkB,EAAE,IAAI,CAAC,QAAQ,EAAE,UAAU;AACrE;;AAEA,EAAE,YAAY,GAAG;AACjB,IAAI,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa,EAAE,IAAI;AAClD,IAAI,IAAI,CAAC,gBAAgB,GAAG;AAC5B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI,OAAO,MAAM,KAAK,WAAW,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;AACtE,EAAE,MAAM,cAAc,GAAG,cAAc,CAAC,IAAI,CAAC,oBAAoB;AACjE,EAAE,IAAI,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE;AACjC,IAAI,cAAc,CAAC,OAAO,CAAC,CAAC,OAAO,KAAK;AACxC,MAAM,aAAa,CAAC,mBAAmB,CAAC,OAAO,EAAE,EAAE,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,YAAY,EAAE;AAC1F,KAAK;AACL;AACA;;;;"}
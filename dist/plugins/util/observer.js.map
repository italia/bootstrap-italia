{"version":3,"file":"observer.js","sources":["../../../src/js/plugins/util/observer.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap Italia (https://italia.github.io/bootstrap-italia/)\n * Authors: https://github.com/italia/bootstrap-italia/blob/main/AUTHORS\n * Licensed under BSD-3-Clause license (https://github.com/italia/bootstrap-italia/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\n/**\n * Mutation CSS Class Observer Object\n */\n//https://stackoverflow.com/a/53914092\n\nclass CssClassObserver {\n  constructor(targetNode, classToWatch, classAddedCallback, classRemovedCallback, ignoreToggle) {\n    this.targetNode = targetNode\n    this.classToWatch = classToWatch\n    this.classAddedCallback = classAddedCallback\n    this.classRemovedCallback = classRemovedCallback\n    this.observer = null\n    this.lastClassState = targetNode.classList.contains(this.classToWatch)\n    this.ignoreToggle = !!ignoreToggle\n\n    this.init()\n  }\n\n  init() {\n    this.observer = new MutationObserver((mutationsList) => this.mutationCallback(mutationsList))\n    this.observe()\n  }\n\n  observe() {\n    this.observer.observe(this.targetNode, { attributes: true })\n  }\n\n  disconnect() {\n    this.observer.disconnect()\n  }\n\n  mutationCallback(mutationsList) {\n    for (let mutation of mutationsList) {\n      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n        let currentClassState = mutation.target.classList.contains(this.classToWatch)\n        if (this.ignoreToggle || this.lastClassState !== currentClassState) {\n          this.lastClassState = currentClassState\n          if (currentClassState) {\n            if (typeof this.classAddedCallback === 'function') {\n              this.classAddedCallback()\n            }\n          } else if (typeof this.classRemovedCallback === 'function') {\n            this.classRemovedCallback()\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * Mutation Content Class Observer Object\n */\n\nclass ContentObserver {\n  constructor(targetNode, contentSelector, contentAddedCallback, contentRemovedCallback) {\n    this.targetNode = targetNode\n    this.contentSelector = contentSelector\n    this.contentAddedCallback = contentAddedCallback\n    this.contentRemovedCallback = contentRemovedCallback\n    this.observer = null\n\n    this.init()\n  }\n\n  //public\n\n  init() {\n    this.observer = new MutationObserver((mutationsList) => this.mutationCallback(mutationsList))\n    this.observe()\n  }\n\n  observe() {\n    this.observer.observe(this.targetNode, { childList: true, subtree: true })\n  }\n\n  disconnect() {\n    this.observer.disconnect()\n  }\n\n  mutationCallback(mutationsList) {\n    for (let mutation of mutationsList) {\n      if (mutation.type === 'childList') {\n        mutation.addedNodes.forEach((node) => {\n          this._callbackExec(node)\n        })\n        mutation.removedNodes.forEach((node) => {\n          this._callbackExec(node, true)\n        })\n      }\n    }\n  }\n\n  //private\n  _callbackExec(node, actionRemove) {\n    const foundNodes = node.matches && node.matches(this.contentSelector) ? [node] : node.querySelectorAll ? node.querySelectorAll(this.contentSelector) : null\n    const callback =\n      actionRemove && typeof this.contentRemovedCallback === 'function'\n        ? this.contentRemovedCallback\n        : typeof this.contentAddedCallback === 'function'\n          ? this.contentAddedCallback\n          : null\n    if (foundNodes && callback) {\n      foundNodes.forEach((node) => callback(node))\n    }\n  }\n}\n\nexport { CssClassObserver, ContentObserver }\n"],"names":[],"mappings":"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"}
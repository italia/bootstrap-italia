{"version":3,"file":"form-validate.js","sources":["../../src/js/plugins/form-validate.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap Italia (https://italia.github.io/bootstrap-italia/)\n * Authors: https://github.com/italia/bootstrap-italia/blob/main/AUTHORS\n * Licensed under BSD-3-Clause license (https://github.com/italia/bootstrap-italia/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport JustValidate from 'just-validate'\nimport { CssClassObserver, ContentObserver } from './util/observer'\n\nconst CONFIG_DEFAULT = {\n  errorFieldCssClass: 'is-invalid',\n  errorLabelCssClass: 'just-validate-error-label',\n}\n\nconst NAME = 'justvalidatebi'\n\nconst CLASS_NAME_SRONLY = 'sr-only-justvalidate-bi'\n\nconst SELECTOR_SPAN_SRONLY = `.${CLASS_NAME_SRONLY}`\n\nclass FormValidate {\n  constructor(selector, config, dictLocale) {\n    this.formSelector = selector\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      return\n    }\n    this.target = document.querySelector(selector)\n\n    if (dictLocale != undefined) this.validate = new JustValidate(selector, config, dictLocale)\n    else {\n      this.validate = new JustValidate(selector, config)\n    }\n\n    this.config = Object.assign({}, CONFIG_DEFAULT, this.validate.globalConfig)\n    this.formItems = []\n\n    this.init()\n\n    return this.validate\n  }\n\n  init() {\n    const inputs = this.target.querySelectorAll('input, select')\n    inputs.forEach((input) => {\n      const watcher = new CssClassObserver(\n        input,\n        this.config.errorFieldCssClass,\n        () => this.onInputError(input),\n        () => this.onInputErrorRemove(input),\n        true\n      )\n      if (!input.id) {\n        input.setAttribute('id', NAME + '-input-' + Math.random())\n      }\n      this.formItems.push({\n        item: input,\n        watcher,\n      })\n    })\n    const fieldsets = this.target.querySelectorAll('fieldset')\n    fieldsets.forEach((field) => {\n      const inputs = field.querySelectorAll('input[type=radio],input[type=checkbox]')\n      if (inputs.length > 0) {\n        const watcher = new ContentObserver(\n          field,\n          '.' + this.config.errorLabelCssClass,\n          () => this.onFieldsetError(field),\n          () => this.onFieldsetErrorRemove(field)\n        )\n        if (!field.id) {\n          field.setAttribute('id', NAME + '-fieldset-' + Math.random())\n        }\n        this.formItems.push({\n          item: field,\n          watcher,\n        })\n      }\n    })\n  }\n\n  /**\n   * Adds ARIA attributes to the input and to the error message\n   * @param {Object} target - the input element\n   */\n  onInputError(target) {\n    const errElements = this.getErrorMessages(target)\n    const errIds = []\n    errElements.forEach((el, idx) => {\n      const id = target.id + '-error-' + idx\n      el.setAttribute('id', id)\n      errIds.push(id)\n    })\n\n    if (errIds.length > 0) {\n      target.setAttribute('aria-describedby', errIds.join(' '))\n      target.setAttribute('aria-invalid', 'true')\n    } /*else {\n      console.warn('[JustValidateIt] the element is invalid but no error message was found', { target })\n    }*/\n  }\n  /**\n   * Removes input ARIA attributes\n   * @param {Object} target - the input element\n   */\n  onInputErrorRemove(target) {\n    target.removeAttribute('aria-describedby')\n    target.setAttribute('aria-invalid', 'false')\n  }\n  /**\n   * Adds ARIA attributes to the fieldset and to the error message\n   * @param {Object} target - the fieldset element\n   */\n  onFieldsetError(target) {\n    const errElements = this.getErrorMessages(target)\n    const errIds = []\n    const errTexts = []\n    errElements.forEach((el, idx) => {\n      const id = target.id + '-error-' + idx\n      el.setAttribute('id', id)\n      errIds.push(id)\n      errTexts.push(el.textContent)\n    })\n\n    if (errIds.length > 0) {\n      const legend = target.querySelector('legend')\n      if (legend) {\n        legend.setAttribute('aria-describedby', errIds.join(' '))\n        legend.setAttribute('aria-invalid', 'true')\n      }\n    }\n  }\n  /**\n   * Removes the fieldset ARIA attributes\n   * @param {Object} target - the fieldset element\n   */\n  onFieldsetErrorRemove(target) {\n    const legend = target.querySelector('legend')\n    if (legend) {\n      legend.removeAttribute('aria-describedby')\n      legend.setAttribute('aria-invalid', 'false')\n      const span = legend.querySelector(SELECTOR_SPAN_SRONLY)\n      if (span) {\n        span.remove()\n      }\n    }\n  }\n\n  /**\n   * get the error messages for the target\n   * @param {Object} target - target node\n   */\n  getErrorMessages(target) {\n    let parent = target\n    let messages = parent.querySelectorAll('.' + this.config.errorLabelCssClass)\n    while (parent != null && messages.length === 0) {\n      parent = parent.parentNode\n      messages = parent.querySelectorAll('.' + this.config.errorLabelCssClass)\n    }\n    return messages\n  }\n}\n\n//Plugins\n/**\n * Validate a custom autocomplete select\n * @param {string} inputId - the input id\n * @param {Object} config - { required }\n */\nconst ValidatorSelectAutocomplete = (inputId, config = {}) => {\n  return (value, fields) => {\n    let result = false\n    const field = fields[inputId]\n    if (field) {\n      if (!config.required && !value) {\n        result = true\n      } else {\n        if (typeof window !== 'undefined' && typeof document !== 'undefined') {\n          document\n            .querySelector('#' + field.elem.id + '-select')\n            .querySelectorAll('option')\n            .forEach((option) => {\n              if (option.text === value) {\n                result = true\n              }\n            })\n        }\n      }\n    } else {\n      throw new Error('ValidatorSelectAutocomplete: ' + inputId + ' not found as form field')\n    }\n\n    return result\n  }\n}\n\nexport { FormValidate, ValidatorSelectAutocomplete }\n"],"names":[],"mappings":"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"}
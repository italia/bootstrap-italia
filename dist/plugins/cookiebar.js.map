{"version":3,"file":"cookiebar.js","sources":["../../src/js/plugins/cookiebar.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap Italia (https://italia.github.io/bootstrap-italia/)\n * Authors: https://github.com/italia/bootstrap-italia/blob/main/AUTHORS\n * Licensed under BSD-3-Clause license (https://github.com/italia/bootstrap-italia/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\n\nimport { isDisabled, getElementFromSelector, reflow } from './util/index'\nimport EventHandler from './dom/event-handler'\n\n/**\n * ------------------------------------------------------------------------\n * Constants\n * ------------------------------------------------------------------------\n */\n\nconst NAME = 'cookiebar'\nconst VERSION = '5.0.0'\nconst DATA_KEY = 'bs.cookiebar'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\nconst COOKIE_NAME = 'cookies_consent'\nconst COOKIE_VALUE = 'true'\nconst COOKIE_EXPIRE = 30\n\nconst SELECTOR_COOKIE_BAR = '.cookiebar'\nconst SELECTOR_ACCEPT = '[data-bs-accept=\"cookiebar\"]'\n\nconst EVENT_CLOSE = `close${EVENT_KEY}`\nconst EVENT_CLOSED = `closed${EVENT_KEY}`\nconst EVENT_LOAD_DATA_API = `load${EVENT_KEY}${DATA_API_KEY}`\nconst EVENT_CLICK_DATA_API = `click${EVENT_KEY}${DATA_API_KEY}`\n\nconst CLASS_NAME_COOKIE_BAR = 'cookiebar'\nconst CLASS_NAME_SHOW = 'show'\nconst CLASS_NAME_FADE = 'fade'\n\n/**\n * ------------------------------------------------------------------------\n * Class Definition\n * ------------------------------------------------------------------------\n */\n\nclass Cookiebar extends BaseComponent {\n  constructor(element) {\n    super(element)\n\n    this._isShown = this._element.classList.contains(CLASS_NAME_SHOW)\n    this._isTransitioning = false\n  }\n\n  // Getters\n  static get NAME() {\n    return NAME\n  }\n\n  static get VERSION() {\n    return VERSION\n  }\n\n  // Public\n\n  show() {\n    if (this._isShown || this._isTransitioning) {\n      return\n    }\n\n    this._isShown = true\n\n    if (this._isAnimated()) {\n      this._isTransitioning = true\n    }\n\n    this._showElement()\n  }\n\n  hide() {\n    if (!this._isShown || this._isTransitioning) {\n      return\n    }\n\n    this._isShown = false\n    const isAnimated = this._isAnimated()\n\n    if (isAnimated) {\n      this._isTransitioning = true\n    }\n\n    this._element.classList.remove(CLASS_NAME_SHOW)\n\n    this._queueCallback(() => this._hideElement(), this._element, isAnimated)\n  }\n\n  accept(element) {\n    element = element || this._element\n\n    const rootElement = this._getRootElement(element)\n    const customEvent = this._triggerCloseEvent(rootElement)\n\n    if (customEvent.defaultPrevented) {\n      return\n    }\n\n    this._setCookieEU()\n\n    this.hide()\n    //this._removeElement(rootElement)\n    //this.dispose()\n  }\n\n  /*dispose() {\n    $.removeData(this._element, DATA_KEY)\n    this._element = null\n  }*/\n\n  static clearCookie() {\n    if (typeof document === 'undefined') {\n      return\n    }\n    document.cookie = COOKIE_NAME + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;'\n  }\n\n  // Private\n\n  _isAnimated() {\n    return this._element.classList.contains(CLASS_NAME_FADE)\n  }\n\n  _showElement() {\n    const isAnimated = this._isAnimated()\n\n    this._element.removeAttribute('aria-hidden')\n    this._element.setAttribute('aria-live', 'polite')\n\n    if (isAnimated) {\n      reflow(this._element)\n    }\n\n    this._element.classList.add(CLASS_NAME_SHOW)\n\n    const transitionComplete = () => {\n      this._isTransitioning = false\n    }\n\n    this._queueCallback(transitionComplete, this._element, isAnimated)\n  }\n\n  _hideElement() {\n    this._element.style.display = 'none'\n    this._element.setAttribute('aria-hidden', true)\n    this._element.removeAttribute('aria-live')\n    this._isTransitioning = false\n  }\n\n  _setCookieEU() {\n    var exdate = new Date()\n    exdate.setDate(exdate.getDate() + COOKIE_EXPIRE)\n    var c_value = escape(COOKIE_VALUE) + (COOKIE_EXPIRE == null ? '' : '; expires=' + exdate.toUTCString())\n    if (typeof document === 'undefined') {\n      return\n    }\n    document.cookie = COOKIE_NAME + '=' + c_value + '; path=/; SameSite=Strict'\n  }\n\n  _getRootElement(element) {\n    const selector = getElementFromSelector(element)\n    let parent = null\n\n    if (selector) {\n      parent = selector\n    }\n\n    if (!parent) {\n      parent = element.closest(`.${CLASS_NAME_COOKIE_BAR}`) //$(element).closest(`.${CLASS_NAME_COOKIE_BAR}`)[0]\n    }\n\n    return parent\n  }\n\n  _triggerCloseEvent(element) {\n    /*const closeEvent = $.Event(EVENT_CLOSE)\n\n    $(element).trigger(closeEvent)*/\n\n    return EventHandler.trigger(element, EVENT_CLOSE)\n  }\n\n  _removeElement(element) {\n    //$(element).removeClass(CLASS_NAME_SHOW).attr('aria-hidden', 'true').attr('aria-live', 'off')\n    element.classList.remove(CLASS_NAME_SHOW)\n    element.setAttribute('aria-hidden', 'true')\n    element.setAttribute('aria-live', 'off')\n\n    //this._destroyElement(element)\n    EventHandler.trigger(element, EVENT_CLOSED)\n\n    this.dispose()\n  }\n\n  static _handleAccept(cookiebarInstance) {\n    return function (event) {\n      if (event) {\n        event.preventDefault()\n      }\n\n      cookiebarInstance.close(this)\n    }\n  }\n\n  static _handleConsent(cookiebarInstance) {\n    return function (event) {\n      if (event) {\n        event.preventDefault()\n      }\n\n      cookiebarInstance.close(this)\n    }\n  }\n\n  static _getCookieEU() {\n    if (typeof document === 'undefined') {\n      return\n    }\n    var i,\n      x,\n      y,\n      ARRcookies = document.cookie.split(';')\n    for (i = 0; i < ARRcookies.length; i++) {\n      x = ARRcookies[i].substring(0, ARRcookies[i].indexOf('='))\n      y = ARRcookies[i].substring(ARRcookies[i].indexOf('=') + 1)\n      x = x.replace(/^\\s+|\\s+$/g, '')\n      if (x == COOKIE_NAME) {\n        return unescape(y)\n      }\n    }\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Api implementation\n * ------------------------------------------------------------------------\n */\n\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n  EventHandler.on(document, EVENT_CLICK_DATA_API, SELECTOR_ACCEPT, function (event) {\n    if (['A', 'AREA'].includes(this.tagName)) {\n      event.preventDefault()\n    }\n\n    if (isDisabled(this)) {\n      return\n    }\n\n    const target = getElementFromSelector(this) || this.closest(`.${NAME}`)\n    const instance = Cookiebar.getOrCreateInstance(target)\n    instance.accept()\n    //Cookiebar._handleAccept(new Cookiebar())\n  })\n\n  EventHandler.on(window, EVENT_LOAD_DATA_API, function () {\n    const consent = Cookiebar._getCookieEU()\n    if (!consent) {\n      if (typeof document === 'undefined') {\n        return\n      }\n      const cookiebars = document.querySelectorAll(SELECTOR_COOKIE_BAR)\n      cookiebars.forEach((bar) => {\n        const instance = Cookiebar.getOrCreateInstance(bar)\n        instance.show()\n      })\n    }\n  })\n}\n\nexport default Cookiebar\n"],"names":[],"mappings":"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"}
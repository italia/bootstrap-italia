{"version":3,"file":"input-search-autocomplete.js","sources":["../../src/js/plugins/input-search-autocomplete.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap Italia (https://italia.github.io/bootstrap-italia/)\n * Authors: https://github.com/italia/bootstrap-italia/blob/main/AUTHORS\n * Licensed under BSD-3-Clause license (https://github.com/italia/bootstrap-italia/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component'\nimport EventHandler from './dom/event-handler'\nimport InputLabel from './input-label'\n\nconst NAME = 'inputsearchautocomplete'\nconst DATA_KEY = 'bs.inputsearchautocomplete'\nconst EVENT_KEY = `.${DATA_KEY}`\n\nconst Default = {\n  autocomplete: [],\n}\n\nconst EVENT_KEYUP = `keyup${EVENT_KEY}`\n\nconst CLASS_NAME_SHOW = 'autocomplete-list-show'\nconst CLASS_NAME_AUTOCOMPLETE = 'autocomplete'\n\nconst DATA_AUTOCOMPLETE = 'data-bs-autocomplete'\n\nconst SELECTOR_SEARCH = 'input[' + DATA_AUTOCOMPLETE + '][type=\"search\"]'\n\nclass InputSearch extends BaseComponent {\n  constructor(element, config) {\n    super(element)\n\n    this._config = this._getConfig(config)\n    this._items = []\n    this._autocompleteElement = null\n\n    this._label = new InputLabel(element)\n\n    this._init()\n    this._bindEvents()\n  }\n\n  // Getters\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  search() {\n    const value = this._element.value\n\n    //!!! $autocomplete.empty()\n    this._autocompleteElement.innerHTML = ''\n\n    if (value) {\n      this._items.forEach((item) => {\n        let markText = new RegExp('(' + value + ')', 'gi')\n        let optionText = item.text.replace(markText, '<mark>$1</mark>')\n        let optionLabel = item.label ? '<em>' + item.label + '</em>' : ''\n        let optionIcon = item.icon ? item.icon : ''\n        let optionLink = item.link ? item.link : '#'\n\n        if (optionText.toLowerCase().indexOf(value.toLowerCase()) !== -1) {\n          this._autocompleteElement.classList.add(CLASS_NAME_SHOW)\n          this._autocompleteElement.appendChild(this._createOption(optionLink, optionText, optionLabel, optionIcon))\n        }\n      })\n    } else {\n      this._autocompleteElement.classList.remove(CLASS_NAME_SHOW)\n    }\n  }\n\n  // Private\n  _getConfig(config) {\n    config = {\n      ...Default,\n      ...(typeof config === 'object' ? config : {}),\n    }\n    return config\n  }\n\n  _getItems() {\n    try {\n      return JSON.parse(this._element.getAttribute(DATA_AUTOCOMPLETE))\n    } catch (error) {\n      console.error('[InputSearchAutocomplete] invalid data provided for ' + DATA_AUTOCOMPLETE + ' attribute', error)\n      return []\n    }\n  }\n\n  _init() {\n    if (this._element.classList.contains(CLASS_NAME_AUTOCOMPLETE)) {\n      if (typeof document === 'undefined') {\n        return\n      }\n      this._items = this._getItems()\n      this._autocompleteElement = document.createElement('ul')\n      this._autocompleteElement.classList.add('autocomplete-list')\n      this._element.parentNode.insertBefore(this._autocompleteElement, this._element.nextSibling)\n    }\n  }\n\n  _bindEvents() {\n    EventHandler.on(this._element, EVENT_KEYUP, () => this.search())\n  }\n\n  _createOption(link, text, label, icon) {\n    if (typeof document === 'undefined') {\n      return\n    }\n    const option = document.createElement('li')\n    option.innerHTML = `<a href=\"${link}\">\n        ${icon}\n        <span class=\"autocomplete-list-text\">\n          <span>${text}</span>\n          ${label}\n        </span>\n      </a>`\n\n    return option\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Api implementation\n * ------------------------------------------------------------------------\n */\n\nconst createInput = (element) => {\n  if (element && element.matches(SELECTOR_SEARCH)) {\n    return InputSearch.getOrCreateInstance(element)\n  }\n  return null\n}\n\nif (typeof document !== 'undefined') {\n  document.addEventListener('DOMContentLoaded', function () {\n    var frmel = document.querySelectorAll(SELECTOR_SEARCH + ', label')\n    frmel.forEach(function (item) {\n      const target = InputLabel.getInputFromLabel(item) || item\n      createInput(target)\n    })\n  })\n}\n\nexport default InputSearch\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAMA,MAAM,IAAI,GAAG;AACb,MAAM,QAAQ,GAAG;AACjB,MAAM,SAAS,GAAG,CAAC,CAAC,EAAE,QAAQ,CAAC;;AAE/B,MAAM,OAAO,GAAG;AAChB,EAAE,YAAY,EAAE,EAAE;AAClB;;AAEA,MAAM,WAAW,GAAG,CAAC,KAAK,EAAE,SAAS,CAAC;;AAEtC,MAAM,eAAe,GAAG;AACxB,MAAM,uBAAuB,GAAG;;AAEhC,MAAM,iBAAiB,GAAG;;AAE1B,MAAM,eAAe,GAAG,QAAQ,GAAG,iBAAiB,GAAG;;AAEvD,MAAM,WAAW,SAAS,aAAa,CAAC;AACxC,EAAE,WAAW,CAAC,OAAO,EAAE,MAAM,EAAE;AAC/B,IAAI,KAAK,CAAC,OAAO;;AAEjB,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM;AACzC,IAAI,IAAI,CAAC,MAAM,GAAG;AAClB,IAAI,IAAI,CAAC,oBAAoB,GAAG;;AAEhC,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,UAAU,CAAC,OAAO;;AAExC,IAAI,IAAI,CAAC,KAAK;AACd,IAAI,IAAI,CAAC,WAAW;AACpB;;AAEA;;AAEA,EAAE,WAAW,IAAI,GAAG;AACpB,IAAI,OAAO;AACX;;AAEA;AACA,EAAE,MAAM,GAAG;AACX,IAAI,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC;;AAEhC;AACA,IAAI,IAAI,CAAC,oBAAoB,CAAC,SAAS,GAAG;;AAE1C,IAAI,IAAI,KAAK,EAAE;AACf,MAAM,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,KAAK;AACpC,QAAQ,IAAI,QAAQ,GAAG,IAAI,MAAM,CAAC,GAAG,GAAG,KAAK,GAAG,GAAG,EAAE,IAAI;AACzD,QAAQ,IAAI,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,iBAAiB;AACtE,QAAQ,IAAI,WAAW,GAAG,IAAI,CAAC,KAAK,GAAG,MAAM,GAAG,IAAI,CAAC,KAAK,GAAG,OAAO,GAAG;AACvE,QAAQ,IAAI,UAAU,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG;AACjD,QAAQ,IAAI,UAAU,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG;;AAEjD,QAAQ,IAAI,UAAU,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE;AAC1E,UAAU,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,GAAG,CAAC,eAAe;AACjE,UAAU,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,UAAU,EAAE,UAAU,EAAE,WAAW,EAAE,UAAU,CAAC;AACnH;AACA,OAAO;AACP,KAAK,MAAM;AACX,MAAM,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,MAAM,CAAC,eAAe;AAChE;AACA;;AAEA;AACA,EAAE,UAAU,CAAC,MAAM,EAAE;AACrB,IAAI,MAAM,GAAG;AACb,MAAM,GAAG,OAAO;AAChB,MAAM,IAAI,OAAO,MAAM,KAAK,QAAQ,GAAG,MAAM,GAAG,EAAE,CAAC;AACnD;AACA,IAAI,OAAO;AACX;;AAEA,EAAE,SAAS,GAAG;AACd,IAAI,IAAI;AACR,MAAM,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,iBAAiB,CAAC;AACrE,KAAK,CAAC,OAAO,KAAK,EAAE;AACpB,MAAM,OAAO,CAAC,KAAK,CAAC,sDAAsD,GAAG,iBAAiB,GAAG,YAAY,EAAE,KAAK;AACpH,MAAM,OAAO;AACb;AACA;;AAEA,EAAE,KAAK,GAAG;AACV,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,uBAAuB,CAAC,EAAE;AACnE,MAAM,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;AAC3C,QAAQ;AACR;AACA,MAAM,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS;AAClC,MAAM,IAAI,CAAC,oBAAoB,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI;AAC7D,MAAM,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,GAAG,CAAC,mBAAmB;AACjE,MAAM,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,QAAQ,CAAC,WAAW;AAChG;AACA;;AAEA,EAAE,WAAW,GAAG;AAChB,IAAI,YAAY,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,EAAE,WAAW,EAAE,MAAM,IAAI,CAAC,MAAM,EAAE;AACnE;;AAEA,EAAE,aAAa,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AACzC,IAAI,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;AACzC,MAAM;AACN;AACA,IAAI,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI;AAC9C,IAAI,MAAM,CAAC,SAAS,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC;AACxC,QAAQ,EAAE,IAAI;AACd;AACA,gBAAgB,EAAE,IAAI,CAAC;AACvB,UAAU,EAAE,KAAK;AACjB;AACA,UAAU;;AAEV,IAAI,OAAO;AACX;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,MAAM,WAAW,GAAG,CAAC,OAAO,KAAK;AACjC,EAAE,IAAI,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC,EAAE;AACnD,IAAI,OAAO,WAAW,CAAC,mBAAmB,CAAC,OAAO;AAClD;AACA,EAAE,OAAO;AACT;;AAEA,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;AACrC,EAAE,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,YAAY;AAC5D,IAAI,IAAI,KAAK,GAAG,QAAQ,CAAC,gBAAgB,CAAC,eAAe,GAAG,SAAS;AACrE,IAAI,KAAK,CAAC,OAAO,CAAC,UAAU,IAAI,EAAE;AAClC,MAAM,MAAM,MAAM,GAAG,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI;AAC3D,MAAM,WAAW,CAAC,MAAM;AACxB,KAAK;AACL,GAAG;AACH;;;;"}
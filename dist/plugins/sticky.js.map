{"version":3,"file":"sticky.js","sources":["../../src/js/plugins/sticky.js"],"sourcesContent":["import BaseComponent from './base-component.js'\n\nimport {\n  getSelectorFromElement, //in base al bs-target\n} from './util/index'\nimport EventHandler from './dom/event-handler'\nimport SelectorEngine from './dom/selector-engine'\nimport Manipulator from './dom/manipulator'\n\nimport { isScreenMobile } from './util/device'\nimport onDocumentScroll from './util/on-document-scroll'\n\nconst NAME = 'sticky'\nconst DATA_KEY = 'bs.sticky'\nconst EVENT_KEY = `.${DATA_KEY}`\n\nconst EVENT_RESIZE = `resize${EVENT_KEY}`\nconst EVENT_STICKY_ON = `on${EVENT_KEY}`\nconst EVENT_STICKY_OFF = `off${EVENT_KEY}`\n\nconst CLASS_NAME_WRAPPER = 'bs-it-sticky-wrapper'\nconst CLASS_NAME_STICKY = 'bs-is-sticky'\nconst CLASS_NAME_FIXED = 'bs-is-fixed'\n\nconst DATA_TARGET_MOBILE = 'data-bs-target-mobile'\n\nconst SELECTOR_DATA_TOGGLE = '[data-bs-toggle=\"sticky\"]'\n\nconst Default = {\n  positionType: 'sticky', //fixed\n  stickyClassName: '',\n  stackable: false,\n  paddingTop: 0,\n}\n\nclass Sticky extends BaseComponent {\n  constructor(element, config) {\n    super(element)\n\n    this._config = this._getConfig(config)\n\n    this._isSticky = false\n    this._wrapper = null\n\n    this._stickyTarget = SelectorEngine.findOne(getSelectorFromElement(this._element), this._element) || this._element\n    this._stickyTargetMobile = SelectorEngine.findOne(this._element.getAttribute(DATA_TARGET_MOBILE), this._element) || this._stickyTarget //needed?\n    this._stickyLimit = 0\n    this._stickyLimitMobile = 0\n    this._setLimit()\n\n    this._scrollCb = null\n\n    this._isMobile = isScreenMobile()\n\n    this._prevTop = 0\n\n    this._onScroll()\n    this._bindEvents()\n  }\n\n  dispose() {\n    if (typeof window !== 'undefined' && typeof document !== 'undefined') {\n      EventHandler.off(window, EVENT_RESIZE)\n      this._scrollCb.dispose()\n\n      super.dispose()\n    }\n  }\n  // Getters\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n\n  // Private\n  _getConfig(config) {\n    config = {\n      ...Default,\n      ...Manipulator.getDataAttributes(this._element),\n      ...(typeof config === 'object' ? config : {}),\n    }\n    return config\n  }\n\n  _bindEvents() {\n    if (typeof window !== 'undefined' && typeof document !== 'undefined') {\n      EventHandler.on(window, EVENT_RESIZE, () => this._onResize())\n      this._scrollCb = onDocumentScroll(() => this._onScroll())\n    }\n  }\n\n  _onResize() {\n    this._isMobile = isScreenMobile()\n    this._setLimit()\n  }\n\n  _onScroll() {\n    this._checkSticky()\n  }\n\n  _setLimit() {\n    this._stickyLimit = this._cumulativeOffset(this._stickyTarget).top\n    this._stickyLimitMobile = this._cumulativeOffset(this._stickyTargetMobile).top\n  }\n\n  _getLimit() {\n    let newLimit = this._isMobile ? this._stickyLimitMobile : this._stickyLimit\n    if (this._config.stackable) {\n      this._getStickySimblings().forEach((sticky, idx) => {\n        const data = sticky.getBoundingClientRect()\n        newLimit -= data.height + (idx === 0 ? parseFloat(sticky.style.top) : 0)\n      })\n    }\n    return newLimit > 0 ? newLimit : 0\n  }\n\n  /**\n   * get the absolute position of an element\n   * @param {*} element - the target element\n   * @returns {Object} - absolute position top and left of the element\n   */\n  _cumulativeOffset(element) {\n    let top = 0\n    let left = 0\n    do {\n      top += element.offsetTop || 0\n      left += element.offsetLeft || 0\n      element = element.offsetParent\n    } while (element)\n\n    return {\n      top: top,\n      left: left,\n    }\n  }\n\n  _isTypeSticky() {\n    return this._config.positionType === 'sticky'\n  }\n\n  _checkSticky() {\n    if (!this._isSticky) {\n      //the target position can change dinamically\n      this._setLimit()\n    }\n    const limit = this._getLimit()\n    if (typeof window !== 'undefined' && window.pageYOffset > limit) {\n      this._setSticky()\n    } else {\n      this._unsetSticky()\n    }\n  }\n  _setSticky() {\n    if (!this._isSticky) {\n      this._isSticky = true\n      let cssClass = CLASS_NAME_STICKY\n      if (!this._isTypeSticky()) {\n        cssClass = CLASS_NAME_FIXED\n        this._wrapper = this._createWrapper()\n      }\n      this._element.classList.add(cssClass)\n      if (this._config.stickyClassName) {\n        this._element.classList.add(this._config.stickyClassName)\n      }\n      this._prevTop = this._element.style.top\n      this._element.style.top = this._getPositionTop() + 'px'\n      EventHandler.trigger(this._element, EVENT_STICKY_ON)\n    }\n  }\n  _unsetSticky() {\n    if (this._isSticky) {\n      let cssClass = CLASS_NAME_STICKY\n      if (!this._isTypeSticky()) {\n        cssClass = CLASS_NAME_FIXED\n        this._destroyWrapper()\n      }\n      this._element.classList.remove(cssClass)\n      if (this._config.stickyClassName) {\n        this._element.classList.remove(this._config.stickyClassName)\n      }\n      this._element.style.top = this._prevTop\n      this._isSticky = false\n      EventHandler.trigger(this._element, EVENT_STICKY_OFF)\n    }\n  }\n\n  _createWrapper() {\n    if (typeof document === 'undefined') {\n      return\n    }\n    const wrapper = document.createElement('div')\n    wrapper.classList.add(CLASS_NAME_WRAPPER)\n    wrapper.style.width = '100%' //this._element.getBoundingClientRect().width + 'px'\n    wrapper.style.height = this._element.getBoundingClientRect().height + 'px'\n    wrapper.style.overflow = 'hidden'\n    // insert wrapper before el in the DOM tree\n    this._element.parentNode.insertBefore(wrapper, this._element)\n    // move el into wrapper\n    wrapper.appendChild(this._element)\n    return wrapper\n  }\n  _destroyWrapper() {\n    if (this._wrapper) {\n      this._wrapper.parentNode.insertBefore(this._element, this._wrapper)\n      this._wrapper.remove()\n    }\n  }\n\n  _getStickySimblings() {\n    const stickies = SelectorEngine.find(SELECTOR_DATA_TOGGLE)\n    return stickies.filter((sticky) => {\n      const instance = Sticky.getInstance(sticky)\n      if (instance && instance._isSticky && sticky !== this._element) {\n        return true\n      }\n      return false\n    })\n  }\n\n  /**\n   * returns the top position of the element considering the config and the other sticky elements\n   */\n  _getPositionTop() {\n    let newTop = 0\n    if (this._config.stackable) {\n      this._getStickySimblings().forEach((sticky, idx) => {\n        const data = sticky.getBoundingClientRect()\n        newTop += data.height + (idx === 0 ? parseFloat(sticky.style.top) : 0)\n      })\n      return newTop\n    } else {\n      return newTop + this._config.paddingTop\n    }\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Api implementation\n * ------------------------------------------------------------------------\n */\n\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n  onDocumentScroll(() => {\n    const stickies = SelectorEngine.find(SELECTOR_DATA_TOGGLE)\n    stickies.map((sticky) => {\n      Sticky.getOrCreateInstance(sticky)\n    })\n  })\n}\n\nexport default Sticky\n"],"names":[],"mappings":";;;;;;;;AAYA,MAAM,IAAI,GAAG;AACb,MAAM,QAAQ,GAAG;AACjB,MAAM,SAAS,GAAG,CAAC,CAAC,EAAE,QAAQ,CAAC;;AAE/B,MAAM,YAAY,GAAG,CAAC,MAAM,EAAE,SAAS,CAAC;AACxC,MAAM,eAAe,GAAG,CAAC,EAAE,EAAE,SAAS,CAAC;AACvC,MAAM,gBAAgB,GAAG,CAAC,GAAG,EAAE,SAAS,CAAC;;AAEzC,MAAM,kBAAkB,GAAG;AAC3B,MAAM,iBAAiB,GAAG;AAC1B,MAAM,gBAAgB,GAAG;;AAEzB,MAAM,kBAAkB,GAAG;;AAE3B,MAAM,oBAAoB,GAAG;;AAE7B,MAAM,OAAO,GAAG;AAChB,EAAE,YAAY,EAAE,QAAQ;AACxB,EAAE,eAAe,EAAE,EAAE;AACrB,EAAE,SAAS,EAAE,KAAK;AAClB,EAAE,UAAU,EAAE,CAAC;AACf;;AAEA,MAAM,MAAM,SAAS,aAAa,CAAC;AACnC,EAAE,WAAW,CAAC,OAAO,EAAE,MAAM,EAAE;AAC/B,IAAI,KAAK,CAAC,OAAO;;AAEjB,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM;;AAEzC,IAAI,IAAI,CAAC,SAAS,GAAG;AACrB,IAAI,IAAI,CAAC,QAAQ,GAAG;;AAEpB,IAAI,IAAI,CAAC,aAAa,GAAG,cAAc,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC;AAC9G,IAAI,IAAI,CAAC,mBAAmB,GAAG,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,kBAAkB,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,cAAa;AAC1I,IAAI,IAAI,CAAC,YAAY,GAAG;AACxB,IAAI,IAAI,CAAC,kBAAkB,GAAG;AAC9B,IAAI,IAAI,CAAC,SAAS;;AAElB,IAAI,IAAI,CAAC,SAAS,GAAG;;AAErB,IAAI,IAAI,CAAC,SAAS,GAAG,cAAc;;AAEnC,IAAI,IAAI,CAAC,QAAQ,GAAG;;AAEpB,IAAI,IAAI,CAAC,SAAS;AAClB,IAAI,IAAI,CAAC,WAAW;AACpB;;AAEA,EAAE,OAAO,GAAG;AACZ,IAAI,IAAI,OAAO,MAAM,KAAK,WAAW,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;AAC1E,MAAM,YAAY,CAAC,GAAG,CAAC,MAAM,EAAE,YAAY;AAC3C,MAAM,IAAI,CAAC,SAAS,CAAC,OAAO;;AAE5B,MAAM,KAAK,CAAC,OAAO;AACnB;AACA;AACA;;AAEA,EAAE,WAAW,IAAI,GAAG;AACpB,IAAI,OAAO;AACX;;AAEA;;AAEA;AACA,EAAE,UAAU,CAAC,MAAM,EAAE;AACrB,IAAI,MAAM,GAAG;AACb,MAAM,GAAG,OAAO;AAChB,MAAM,GAAG,WAAW,CAAC,iBAAiB,CAAC,IAAI,CAAC,QAAQ,CAAC;AACrD,MAAM,IAAI,OAAO,MAAM,KAAK,QAAQ,GAAG,MAAM,GAAG,EAAE,CAAC;AACnD;AACA,IAAI,OAAO;AACX;;AAEA,EAAE,WAAW,GAAG;AAChB,IAAI,IAAI,OAAO,MAAM,KAAK,WAAW,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;AAC1E,MAAM,YAAY,CAAC,EAAE,CAAC,MAAM,EAAE,YAAY,EAAE,MAAM,IAAI,CAAC,SAAS,EAAE;AAClE,MAAM,IAAI,CAAC,SAAS,GAAG,gBAAgB,CAAC,MAAM,IAAI,CAAC,SAAS,EAAE;AAC9D;AACA;;AAEA,EAAE,SAAS,GAAG;AACd,IAAI,IAAI,CAAC,SAAS,GAAG,cAAc;AACnC,IAAI,IAAI,CAAC,SAAS;AAClB;;AAEA,EAAE,SAAS,GAAG;AACd,IAAI,IAAI,CAAC,YAAY;AACrB;;AAEA,EAAE,SAAS,GAAG;AACd,IAAI,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;AACnE,IAAI,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;AAC/E;;AAEA,EAAE,SAAS,GAAG;AACd,IAAI,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;AACnE,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;AAChC,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,GAAG,KAAK;AAC1D,QAAQ,MAAM,IAAI,GAAG,MAAM,CAAC,qBAAqB;AACjD,QAAQ,QAAQ,IAAI,IAAI,CAAC,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC;AAC/E,OAAO;AACP;AACA,IAAI,OAAO,QAAQ,GAAG,CAAC,GAAG,QAAQ,GAAG;AACrC;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE,iBAAiB,CAAC,OAAO,EAAE;AAC7B,IAAI,IAAI,GAAG,GAAG;AACd,IAAI,IAAI,IAAI,GAAG;AACf,IAAI,GAAG;AACP,MAAM,GAAG,IAAI,OAAO,CAAC,SAAS,IAAI;AAClC,MAAM,IAAI,IAAI,OAAO,CAAC,UAAU,IAAI;AACpC,MAAM,OAAO,GAAG,OAAO,CAAC;AACxB,KAAK,QAAQ,OAAO;;AAEpB,IAAI,OAAO;AACX,MAAM,GAAG,EAAE,GAAG;AACd,MAAM,IAAI,EAAE,IAAI;AAChB;AACA;;AAEA,EAAE,aAAa,GAAG;AAClB,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,YAAY,KAAK;AACzC;;AAEA,EAAE,YAAY,GAAG;AACjB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;AACzB;AACA,MAAM,IAAI,CAAC,SAAS;AACpB;AACA,IAAI,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS;AAChC,IAAI,IAAI,OAAO,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,WAAW,GAAG,KAAK,EAAE;AACrE,MAAM,IAAI,CAAC,UAAU;AACrB,KAAK,MAAM;AACX,MAAM,IAAI,CAAC,YAAY;AACvB;AACA;AACA,EAAE,UAAU,GAAG;AACf,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;AACzB,MAAM,IAAI,CAAC,SAAS,GAAG;AACvB,MAAM,IAAI,QAAQ,GAAG;AACrB,MAAM,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,EAAE;AACjC,QAAQ,QAAQ,GAAG;AACnB,QAAQ,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,cAAc;AAC3C;AACA,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ;AAC1C,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE;AACxC,QAAQ,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe;AAChE;AACA,MAAM,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;AAC1C,MAAM,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC,eAAe,EAAE,GAAG;AACzD,MAAM,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,eAAe;AACzD;AACA;AACA,EAAE,YAAY,GAAG;AACjB,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE;AACxB,MAAM,IAAI,QAAQ,GAAG;AACrB,MAAM,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,EAAE;AACjC,QAAQ,QAAQ,GAAG;AACnB,QAAQ,IAAI,CAAC,eAAe;AAC5B;AACA,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ;AAC7C,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE;AACxC,QAAQ,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe;AACnE;AACA,MAAM,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC;AACrC,MAAM,IAAI,CAAC,SAAS,GAAG;AACvB,MAAM,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,gBAAgB;AAC1D;AACA;;AAEA,EAAE,cAAc,GAAG;AACnB,IAAI,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;AACzC,MAAM;AACN;AACA,IAAI,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK;AAChD,IAAI,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,kBAAkB;AAC5C,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,OAAM;AAChC,IAAI,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,qBAAqB,EAAE,CAAC,MAAM,GAAG;AAC1E,IAAI,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG;AAC7B;AACA,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,YAAY,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ;AAChE;AACA,IAAI,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ;AACrC,IAAI,OAAO;AACX;AACA,EAAE,eAAe,GAAG;AACpB,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;AACvB,MAAM,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ;AACxE,MAAM,IAAI,CAAC,QAAQ,CAAC,MAAM;AAC1B;AACA;;AAEA,EAAE,mBAAmB,GAAG;AACxB,IAAI,MAAM,QAAQ,GAAG,cAAc,CAAC,IAAI,CAAC,oBAAoB;AAC7D,IAAI,OAAO,QAAQ,CAAC,MAAM,CAAC,CAAC,MAAM,KAAK;AACvC,MAAM,MAAM,QAAQ,GAAG,MAAM,CAAC,WAAW,CAAC,MAAM;AAChD,MAAM,IAAI,QAAQ,IAAI,QAAQ,CAAC,SAAS,IAAI,MAAM,KAAK,IAAI,CAAC,QAAQ,EAAE;AACtE,QAAQ,OAAO;AACf;AACA,MAAM,OAAO;AACb,KAAK;AACL;;AAEA;AACA;AACA;AACA,EAAE,eAAe,GAAG;AACpB,IAAI,IAAI,MAAM,GAAG;AACjB,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;AAChC,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,GAAG,KAAK;AAC1D,QAAQ,MAAM,IAAI,GAAG,MAAM,CAAC,qBAAqB;AACjD,QAAQ,MAAM,IAAI,IAAI,CAAC,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC;AAC7E,OAAO;AACP,MAAM,OAAO;AACb,KAAK,MAAM;AACX,MAAM,OAAO,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AACnC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,IAAI,OAAO,MAAM,KAAK,WAAW,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;AACtE,EAAE,gBAAgB,CAAC,MAAM;AACzB,IAAI,MAAM,QAAQ,GAAG,cAAc,CAAC,IAAI,CAAC,oBAAoB;AAC7D,IAAI,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK;AAC7B,MAAM,MAAM,CAAC,mBAAmB,CAAC,MAAM;AACvC,KAAK;AACL,GAAG;AACH;;;;"}
{"version":3,"file":"sticky.js","sources":["../../src/js/plugins/sticky.js"],"sourcesContent":["import BaseComponent from 'bootstrap/js/src/base-component.js'\n\nimport {\n  //defineJQueryPlugin,\n  //getElementFromSelector,\n  //isVisible,\n  //reflow,\n  //typeCheckConfig,\n  getSelectorFromElement, //in base al bs-target\n} from 'bootstrap/js/src/util'\nimport EventHandler from 'bootstrap/js/src/dom/event-handler'\nimport SelectorEngine from 'bootstrap/js/src/dom/selector-engine'\nimport Manipulator from 'bootstrap/js/src/dom/manipulator'\n\nimport { isScreenMobile } from './util/device'\nimport onDocumentScroll from './util/on-document-scroll'\n\nconst NAME = 'sticky'\nconst DATA_KEY = 'bs.sticky'\nconst EVENT_KEY = `.${DATA_KEY}`\n//const DATA_API_KEY = '.data-api'\n\n//const EVENT_SCROLL = `scroll${EVENT_KEY}`\nconst EVENT_RESIZE = `resize${EVENT_KEY}`\nconst EVENT_STICKY_ON = `on${EVENT_KEY}`\nconst EVENT_STICKY_OFF = `off${EVENT_KEY}`\n\nconst CLASS_NAME_WRAPPER = 'bs-it-sticky-wrapper'\nconst CLASS_NAME_STICKY = 'bs-is-sticky'\nconst CLASS_NAME_FIXED = 'bs-is-fixed'\n\nconst DATA_TARGET_MOBILE = 'data-bs-target-mobile'\n\nconst SELECTOR_DATA_TOGGLE = '[data-bs-toggle=\"sticky\"]'\n\nconst Default = {\n  positionType: 'sticky', //fixed\n  stickyClassName: '',\n  stackable: false,\n  paddingTop: 0,\n}\n\nclass Sticky extends BaseComponent {\n  constructor(element, config) {\n    super(element)\n\n    this._config = this._getConfig(config)\n\n    this._isSticky = false\n    this._wrapper = null\n\n    this._stickyTarget = SelectorEngine.findOne(getSelectorFromElement(this._element), this._element) || this._element\n    this._stickyTargetMobile = SelectorEngine.findOne(this._element.getAttribute(DATA_TARGET_MOBILE), this._element) || this._stickyTarget //needed?\n    this._stickyLimit = 0\n    this._stickyLimitMobile = 0\n    this._setLimit()\n\n    this._scrollCb = null\n\n    this._isMobile = isScreenMobile()\n\n    this._prevTop = 0\n\n    this._onScroll()\n    this._bindEvents()\n  }\n\n  dispose() {\n    EventHandler.off(window, EVENT_RESIZE)\n    this._scrollCb.dispose()\n\n    super.dispose()\n  }\n  // Getters\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n\n  // Private\n  _getConfig(config) {\n    config = {\n      ...Default,\n      ...Manipulator.getDataAttributes(this._element),\n      ...(typeof config === 'object' ? config : {}),\n    }\n    return config\n  }\n\n  _bindEvents() {\n    EventHandler.on(window, EVENT_RESIZE, () => this._onResize())\n    //EventHandler.on(window, EVENT_SCROLL, () => this._onScroll())\n    this._scrollCb = onDocumentScroll(() => this._onScroll())\n  }\n\n  _onResize() {\n    this._isMobile = isScreenMobile()\n    this._setLimit()\n  }\n\n  _onScroll() {\n    this._checkSticky()\n  }\n\n  _setLimit() {\n    this._stickyLimit = this._cumulativeOffset(this._stickyTarget).top\n    this._stickyLimitMobile = this._cumulativeOffset(this._stickyTargetMobile).top\n  }\n\n  _getLimit() {\n    let newLimit = this._isMobile ? this._stickyLimitMobile : this._stickyLimit\n    if (this._config.stackable) {\n      this._getStickySimblings().forEach((sticky, idx) => {\n        const data = sticky.getBoundingClientRect()\n        newLimit -= data.height + (idx === 0 ? parseFloat(sticky.style.top) : 0)\n      })\n    }\n    return newLimit > 0 ? newLimit : 0\n  }\n\n  /**\n   * get the absolute position of an element\n   * @param {*} element - the target element\n   * @returns {Object} - absolute position top and left of the element\n   */\n  _cumulativeOffset(element) {\n    let top = 0\n    let left = 0\n    do {\n      top += element.offsetTop || 0\n      left += element.offsetLeft || 0\n      element = element.offsetParent\n    } while (element)\n\n    return {\n      top: top,\n      left: left,\n    }\n  }\n\n  _isTypeSticky() {\n    return this._config.positionType === 'sticky'\n  }\n\n  _checkSticky() {\n    if (!this._isSticky) {\n      //the target position can change dinamically\n      this._setLimit()\n    }\n    const limit = this._getLimit()\n    if (window.pageYOffset > limit) {\n      this._setSticky()\n    } else {\n      this._unsetSticky()\n    }\n  }\n  _setSticky() {\n    if (!this._isSticky) {\n      this._isSticky = true\n      let cssClass = CLASS_NAME_STICKY\n      if (!this._isTypeSticky()) {\n        cssClass = CLASS_NAME_FIXED\n        this._wrapper = this._createWrapper()\n      }\n      this._element.classList.add(cssClass)\n      if (this._config.stickyClassName) {\n        this._element.classList.add(this._config.stickyClassName)\n      }\n      this._prevTop = this._element.style.top\n      this._element.style.top = this._getPositionTop() + 'px'\n      EventHandler.trigger(this._element, EVENT_STICKY_ON)\n    }\n  }\n  _unsetSticky() {\n    if (this._isSticky) {\n      let cssClass = CLASS_NAME_STICKY\n      if (!this._isTypeSticky()) {\n        cssClass = CLASS_NAME_FIXED\n        this._destroyWrapper()\n      }\n      this._element.classList.remove(cssClass)\n      if (this._config.stickyClassName) {\n        this._element.classList.remove(this._config.stickyClassName)\n      }\n      this._element.style.top = this._prevTop\n      this._isSticky = false\n      EventHandler.trigger(this._element, EVENT_STICKY_OFF)\n    }\n  }\n\n  _createWrapper() {\n    const wrapper = document.createElement('div')\n    wrapper.classList.add(CLASS_NAME_WRAPPER)\n    wrapper.style.width = '100%' //this._element.getBoundingClientRect().width + 'px'\n    wrapper.style.height = this._element.getBoundingClientRect().height + 'px'\n    wrapper.style.overflow = 'hidden'\n    // insert wrapper before el in the DOM tree\n    this._element.parentNode.insertBefore(wrapper, this._element)\n    // move el into wrapper\n    wrapper.appendChild(this._element)\n    return wrapper\n  }\n  _destroyWrapper() {\n    if (this._wrapper) {\n      this._wrapper.parentNode.insertBefore(this._element, this._wrapper)\n      this._wrapper.remove()\n    }\n  }\n\n  _getStickySimblings() {\n    const stickies = SelectorEngine.find(SELECTOR_DATA_TOGGLE)\n    return stickies.filter((sticky) => {\n      const instance = Sticky.getInstance(sticky)\n      if (instance && instance._isSticky && sticky !== this._element) {\n        return true\n      }\n      return false\n    })\n  }\n\n  /**\n   * returns the top position of the element considering the config and the other sticky elements\n   */\n  _getPositionTop() {\n    let newTop = 0\n    if (this._config.stackable) {\n      this._getStickySimblings().forEach((sticky, idx) => {\n        const data = sticky.getBoundingClientRect()\n        newTop += data.height + (idx === 0 ? parseFloat(sticky.style.top) : 0)\n      })\n      return newTop\n    } else {\n      return newTop + this._config.paddingTop\n    }\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Api implementation\n * ------------------------------------------------------------------------\n */\n\nonDocumentScroll(() => {\n  const stickies = SelectorEngine.find(SELECTOR_DATA_TOGGLE)\n  stickies.map((sticky) => {\n    Sticky.getOrCreateInstance(sticky)\n  })\n})\n\nexport default Sticky\n"],"names":[],"mappings":"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"}
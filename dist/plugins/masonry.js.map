{"version":3,"file":"masonry.js","sources":["../../src/js/plugins/masonry.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap Italia (https://italia.github.io/bootstrap-italia/)\n * Authors: https://github.com/italia/bootstrap-italia/blob/main/AUTHORS\n * Licensed under BSD-3-Clause license (https://github.com/italia/bootstrap-italia/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\n\nimport SelectorEngine from './dom/selector-engine'\nimport Manipulator from './dom/manipulator'\n\nimport MiniMasonry from 'minimasonry/src/minimasonry'\n\nconst NAME = 'masonry'\n\nconst CLASS_NAME_SHOW = 'show'\nconst CLASS_NAME_LOADER = 'masonry-loader'\n\nconst SELECTOR_DATA_TOGGLE = '[data-bs-toggle=\"masonry\"]'\nconst SELECTOR_LOADER = `.${CLASS_NAME_LOADER}`\n\nconst Default = {\n  percentPosition: true,\n}\n\nclass Masonry extends BaseComponent {\n  constructor(element, config) {\n    super(element)\n\n    if (typeof window !== 'undefined' && typeof document !== 'undefined') {\n      this._config = this._getConfig(config)\n      this._masonry = null\n      this._images = SelectorEngine.find('img', this._element)\n      this._loadCounter = 0\n      this._init()\n    }\n  }\n\n  // Getters\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  dispose() {\n    if (this._masonry) {\n      this._masonry.destroy()\n      this._masonry = null\n    }\n\n    super.dispose()\n  }\n\n  // Public\n  layout() {\n    if (this._masonry) {\n      this._masonry.layout()\n    }\n  }\n\n  // Private\n  _getConfig(config) {\n    config = {\n      ...Default,\n      ...Manipulator.getDataAttributes(this._element),\n      ...(typeof config === 'object' ? config : {}),\n    }\n    return config\n  }\n\n  _init() {\n    if (this._images.length > 0) {\n      this._images.forEach((img) => {\n        const imgDummy = new Image()\n        imgDummy.onload = () => this._onLoadEnd()\n        imgDummy.src = img.src\n      })\n    } else {\n      this._initMasonry()\n    }\n  }\n\n  _onLoadEnd() {\n    this._loadCounter++\n    if (this._loadCounter >= this._images.length) {\n      this._initMasonry()\n    }\n  }\n\n  _initMasonry() {\n    const config = this._config\n    config.container = this._element\n    this._masonry = new MiniMasonry(config)\n  }\n\n  _createLoader() {\n    if (typeof document === 'undefined') {\n      return\n    }\n    const loader = document.createElement('div')\n    loader.classList.add(CLASS_NAME_LOADER, 'fade', 'd-flex', 'justify-content-center', 'align-items-center')\n    loader.innerHTML = '<div class=\"progress-spinner progress-spinner-active\"><span class=\"visually-hidden\">Caricamento...</span></div>'\n    this._element.appendChild(loader)\n    return loader\n  }\n  _getOrCreateLoader() {\n    const loader = SelectorEngine.findOne(SELECTOR_LOADER, this._element)\n    if (!loader) {\n      return this._createLoader()\n    }\n    return loader\n  }\n  _destroyLoader() {\n    const loader = SelectorEngine.findOne(SELECTOR_LOADER, this._element)\n    if (loader) {\n      loader.remove()\n    }\n  }\n  _showLoader() {\n    const loader = this._getOrCreateLoader()\n    loader.classList.add(CLASS_NAME_SHOW)\n  }\n  _hideLoader() {\n    this._destroyLoader()\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Api implementation\n * ------------------------------------------------------------------------\n */\n\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n  const masonries = SelectorEngine.find(SELECTOR_DATA_TOGGLE)\n  if (masonries.length > 0) {\n    masonries.forEach((masonry) => {\n      Masonry.getOrCreateInstance(masonry)\n    })\n  }\n}\n\nexport default Masonry\n"],"names":[],"mappings":"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"}
{"version":3,"file":"masonry.js","sources":["../../src/js/plugins/masonry.js"],"sourcesContent":["import BaseComponent from 'bootstrap/js/src/base-component.js'\n\nimport SelectorEngine from 'bootstrap/js/src/dom/selector-engine'\nimport Manipulator from 'bootstrap/js/src/dom/manipulator'\n\nimport MasonryPlugin from 'masonry-layout'\n\nconst NAME = 'masonry'\n//const DATA_KEY = 'bs.masonry'\n//const EVENT_KEY = `.${DATA_KEY}`\n//const DATA_API_KEY = '.data-api'\n\nconst CLASS_NAME_SHOW = 'show'\nconst CLASS_NAME_LOADER = 'masonry-loader'\n\nconst SELECTOR_DATA_TOGGLE = '[data-bs-toggle=\"masonry\"]'\nconst SELECTOR_LOADER = `.${CLASS_NAME_LOADER}`\n\nconst Default = {\n  percentPosition: true,\n}\n\nclass Masonry extends BaseComponent {\n  constructor(element, config) {\n    super(element)\n\n    this._config = this._getConfig(config)\n    this._masonry = null\n\n    this._images = SelectorEngine.find('img', this._element)\n    this._loadCounter = 0\n\n    this._init()\n  }\n\n  // Getters\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  dispose() {\n    if (this._masonry) {\n      this._masonry.destroy()\n      this._masonry = null\n    }\n\n    super.dispose()\n  }\n\n  // Private\n  _getConfig(config) {\n    config = {\n      ...Default,\n      ...Manipulator.getDataAttributes(this._element),\n      ...(typeof config === 'object' ? config : {}),\n    }\n    return config\n  }\n\n  _init() {\n    if (this._images.length > 0) {\n      //this._showLoader()\n\n      this._images.forEach((img) => {\n        const imgDummy = new Image()\n        imgDummy.onload = () => this._onLoadEnd()\n        imgDummy.src = img.src\n      })\n    } else {\n      this._initMasonry()\n    }\n  }\n\n  _onLoadEnd() {\n    this._loadCounter++\n    if (this._loadCounter >= this._images.length) {\n      //this._hideLoader()\n      this._initMasonry()\n    }\n  }\n\n  _initMasonry() {\n    this._masonry = new MasonryPlugin(this._element, this._config)\n  }\n\n  _createLoader() {\n    if (typeof document === 'undefined') {\n      return\n    }\n    const loader = document.createElement('div')\n    loader.classList.add(CLASS_NAME_LOADER, 'fade', 'd-flex', 'justify-content-center', 'align-items-center')\n    loader.innerHTML = '<div class=\"progress-spinner progress-spinner-active\"><span class=\"visually-hidden\">Caricamento...</span></div>'\n    this._element.appendChild(loader)\n    return loader\n  }\n  _getOrCreateLoader() {\n    const loader = SelectorEngine.findOne(SELECTOR_LOADER, this._element)\n    if (!loader) {\n      return this._createLoader()\n    }\n    return loader\n  }\n  _destroyLoader() {\n    const loader = SelectorEngine.findOne(SELECTOR_LOADER, this._element)\n    if (loader) {\n      loader.remove()\n    }\n  }\n  _showLoader() {\n    const loader = this._getOrCreateLoader()\n    loader.classList.add(CLASS_NAME_SHOW)\n  }\n  _hideLoader() {\n    this._destroyLoader()\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Api implementation\n * ------------------------------------------------------------------------\n */\n\nconst masonries = SelectorEngine.find(SELECTOR_DATA_TOGGLE)\nif (masonries.length > 0) {\n  /*if (!MASONRY_EXISTS) {\n    console.warn('[Masonry] Masonry component needs Masonry library to work properly')\n  } else {\n    masonries.forEach((masonry) => {\n      Masonry.getOrCreateInstance(masonry)\n    })\n  }*/\n  masonries.forEach((masonry) => {\n    Masonry.getOrCreateInstance(masonry)\n  })\n}\n\nexport default Masonry\n"],"names":[],"mappings":"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"}